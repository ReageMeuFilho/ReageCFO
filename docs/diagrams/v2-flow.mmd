sequenceDiagram
    participant Invoice as ğŸ“„ Invoice
    participant Agent as ğŸ¤– AI Agent<br/>(CDP Wallet)
    participant Pyth as ğŸ“Š Pyth Network
    participant Ledger as ğŸ›ï¸ EVVM Ledger<br/>(Sepolia)
    participant LZ as â›“ï¸ LayerZero
    participant Vault as ğŸ’° Vault<br/>(Base Sepolia)
    participant Vendor as ğŸ‘¤ Vendor

    Note over Invoice,Vendor: V2: Complete End-to-End Cross-Chain Payment

    Invoice->>Agent: New invoice received<br/>INV-LIVE-xxx<br/>Amount: 0.0001 ETH
    
    Agent->>Agent: Load invoice data<br/>Vendor: Acme Cloud<br/>Recipient: 0x742D...
    
    Agent->>Pyth: Fetch real-time price<br/>ETH/USD feed
    Pyth-->>Agent: Price: $2,742.32<br/>Confidence: Â±$1.19
    
    Agent->>Agent: ğŸ¤– AI Decision Logic<br/>âœ… Price > $2000<br/>âœ… Amount < $5000<br/>âœ… Invoice valid
    
    Note over Agent: DECISION: APPROVE
    
    Agent->>Ledger: sendCrossChainPayment()<br/>Signed by CDP Wallet<br/>0xBCD8...
    
    Note over Ledger: ğŸ›ï¸ EVVM Sovereign Ledger<br/>Double-entry accounting<br/>Debits = Credits
    
    Ledger->>Ledger: Record payment<br/>Create pending state<br/>(Financial Tension)
    
    Ledger->>LZ: Send cross-chain message<br/>Destination: Base Sepolia<br/>EID: 40245
    
    Note over LZ: Message in transit<br/>Verification & delivery
    
    LZ->>Vault: lzReceive()<br/>Payment data delivered
    
    Vault->>Vault: Verify message<br/>Release funds
    
    Vault->>Vendor: Transfer 0.0001 ETH<br/>To: 0x742D...
    
    Note over Ledger: âœ… Commit transaction<br/>Pending â†’ Settled
    
    Note over Invoice,Vendor: âœ… Payment Complete<br/>TX: 0x9ec4ae37...<br/>Status: DELIVERED
